<!DOCTYPE html>
<html>
  <head>
    <title>Web App Editor</title>
    <style>
      textarea {
        width: 100%;
        height: 300px;
        font-family: monospace;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h2>Edit File Content</h2>
    <textarea id="editor">Loading...</textarea><br>
    <button onclick="saveToGitHub()">üíæ Save to GitHub</button>

    <h3>Download Android App</h3>
    <p>
      <a id="apkLink" href="#" target="_blank" style="display:none;">‚¨á Download APK</a><br>
      <a id="aabLink" href="#" target="_blank" style="display:none;">‚¨á Download AAB</a>
    </p>

    <script>
      // Load current file content
      fetch("https://raw.githubusercontent.com/Figsh/ekuApp/master/app/src/main/assets/index.html")
        .then(res => res.text())
        .then(data => {
          document.getElementById("editor").value = data;
        });

      function saveToGitHub() {
        const content = document.getElementById("editor").value;

        fetch("/.netlify/functions/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content })
        })
        .then(res => res.json())
        .then(data => {
          alert("‚úÖ Saved! Rebuilding APK...");

          // Show download links (automatically updated via GitHub release)
          document.getElementById("apkLink").href =
            "https://github.com/Figsh/ekuApp/releases/download/latest-build/app-release.apk";
          document.getElementById("apkLink").style.display = "inline";

          document.getElementById("aabLink").href =
            "https://github.com/Figsh/ekuApp/releases/download/latest-build/app-release.aab";
          document.getElementById("aabLink").style.display = "inline";
        })
        .catch(err => alert("‚ùå Error: " + err));
      }
    </script>
  </body>
</html>
